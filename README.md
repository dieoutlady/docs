# 三凡物联网服务器协议说明文档

服务器通信使用基于**http**的**rest**协议，并不完全准守restful规范标准。  
根据实际情况设计服务器内部和外部的协议规则。   


## 全局默认说明

### 数据格式
- **所有数据为json格式**  
string化的json，buffer化的json，或者json本身  
- **请求失败**  
如果请求失败则返回：**{ret:原因编码}**   
- **json内部格式**  
无论什么请求数据统一的存放位置为：**{data:数据}**   

### 默认参数
- **参数中带project字段以区分项目**  
比如 localhost:41111/add?**project=ligong_water**

### 文档解释
- **未带有某项说明者，此项为无数据**  
- **项目的差异化部分。此文档不做说明。**


## 协议说明

### MongoDB模块 端口41111 
- **/add** 增加数据  
--body：json  

- **/history** 取得历史数据  
参数：**skip**<跳过的数量>，**limit**<数量限制>  
返回：json  

- **/total** 数据数量  
返回：json  

### 大数据模块 端口30911 对外
- **/search** 数据索搜
参数：**skip**<跳过的数量>，**limit**<数量限制>  
返回：json  

### WebSocket模块
- **REST 数据接收 端口32200**  

- - **/count** 请求在线人数  
返回：json  
- - **/runtime** 提交实时数据  
body：json  


- **WebSocket 数据发送 端口32201 对外**  
请求地址为：**/项目名称**，不用带任何参数。

### 数据接收模块 收录设备等传入数据 对外
- **modbus协议 端口502**
- **mqtt协议 端口1883**
- **lora协议 端口1680**

### Log模块，表名==项目名称
- **存储日志**
body：json  
